<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø´Ø§Ø®Øµ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ù‡ÙˆØ§ÛŒ Ø§ÛŒØ±Ø§Ù†</title>

<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.min.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Vazirmatn,Tahoma;}
body{background:linear-gradient(135deg,#e3f2fd,#ede7f6);color:#222;overflow-x:hidden;}
header{text-align:center;padding:16px;font-size:26px;font-weight:900;color:#1e88e5;}
main{max-width:1000px;margin:auto;padding:12px;display:none;}
footer{text-align:center;padding:14px;color:#555;font-size:14px;}

/* ===== Loader ===== */
#loader{position:fixed;inset:0;background:#f5f9ff;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;}
.loader-title{font-size:28px;font-weight:900;color:#1e88e5;margin-bottom:20px;}
.spinner{width:60px;height:60px;border:6px solid #bbdefb;border-top-color:#1e88e5;border-radius:50%;animation:spin 1s linear infinite;}
.loader-footer{margin-top:20px;color:#555;font-size:14px;}
@keyframes spin{to{transform:rotate(360deg)}}

/* ===== Search ===== */
.search-box{display:flex;justify-content:center;position:relative;margin-bottom:20px;}
.search-box input{width:100%;max-width:360px;padding:12px 42px 12px 16px;border-radius:16px;border:none;outline:none;background:rgba(255,255,255,0.7);backdrop-filter:blur(10px);font-size:15px;box-shadow:0 8px 24px rgba(0,0,0,0.12);transition:0.3s;}
.search-box input:focus{transform:scale(1.03);box-shadow:0 12px 30px rgba(30,136,229,0.35);}
.search-box::after{content:"ğŸ”";position:absolute;margin-top:12px;margin-left:-40px;pointer-events:none;}

/* ===== Mean AQI ===== */
#meanAQI{text-align:center;font-size:20px;font-weight:700;margin-bottom:14px;color:#1e88e5;}

/* ===== Cards ===== */
.list{display:grid;gap:14px;}
.card{display:flex;justify-content:space-between;align-items:center;padding:16px;border-radius:22px;background:rgba(255,255,255,0.55);backdrop-filter:blur(16px);box-shadow:0 15px 35px rgba(0,0,0,0.15);transition:0.3s;}
.card:hover{transform:scale(1.02);box-shadow:0 18px 40px rgba(0,0,0,0.2);}
.city{font-size:18px;font-weight:900;}
.sub{font-size:13px;color:#555;margin-top:4px;}
.aqi-box{min-width:90px;text-align:center;padding:10px;border-radius:16px;color:#fff;font-weight:900;font-size:18px;}
.change-box{font-size:13px;margin-top:4px;font-weight:700;}

/* Colors */
.good{background:#4caf50;}
.mid{background:#ffc107;}
.bad{background:#ff7043;}
.danger{background:#e53935;}
.change-up{color:#e53935;}
.change-down{color:#4caf50;}
</style>
</head>
<body>

<!-- Loader -->
<div id="loader">
  <div class="loader-title">Ø´Ø§Ø®Øµ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ù‡ÙˆØ§ÛŒ Ø§ÛŒØ±Ø§Ù†</div>
  <div class="spinner"></div>
  <div class="loader-footer">Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ Ø¹Ø´Ù‚ ØªÙˆØ³Ø· BGM STUDIO</div>
</div>

<header>Ø´Ø§Ø®Øµ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ù‡ÙˆØ§ÛŒ Ø§ÛŒØ±Ø§Ù†</header>

<main>
  <div class="search-box">
    <input id="search" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯...">
  </div>

  <div id="meanAQI">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ú©Ù„ Ø§ÛŒØ±Ø§Ù†: --</div>

  <div class="list" id="list"></div>
</main>

<footer>Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ Ø¹Ø´Ù‚ ØªÙˆØ³Ø· BGM STUDIO</footer>

<script>
const cities={
"ØªÙ‡Ø±Ø§Ù†":[35.6892,51.3890],"Ù…Ø´Ù‡Ø¯":[36.2605,59.6168],"Ø§ØµÙÙ‡Ø§Ù†":[32.6546,51.6680],"Ø´ÛŒØ±Ø§Ø²":[29.5918,52.5837],
"ØªØ¨Ø±ÛŒØ²":[38.0962,46.2738],"Ú©Ø±Ø¬":[35.8400,51.0000],"Ø§Ù‡ÙˆØ§Ø²":[31.3183,48.6706],"Ù‚Ù…":[34.6401,50.8764],
"Ø±Ø´Øª":[37.2808,49.5832],"Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³":[27.1865,56.2808],"Ú©Ø±Ù…Ø§Ù†":[30.2839,57.0839],"ÛŒØ²Ø¯":[31.8974,54.3569],
"Ø§Ø±ÙˆÙ…ÛŒÙ‡":[37.5483,45.0672],"Ø§Ø±Ø§Ú©":[34.0917,49.6892],"Ø³Ù†Ù†Ø¯Ø¬":[35.3219,46.9862],"Ù‚Ø²ÙˆÛŒÙ†":[36.2688,50.0041],
"Ø®Ø±Ù…â€ŒØ¢Ø¨Ø§Ø¯":[33.4878,48.3550],"Ù‡Ù…Ø¯Ø§Ù†":[34.8090,48.5150],"Ø³Ù…Ù†Ø§Ù†":[35.5753,53.3958],"Ø²Ø§Ù‡Ø¯Ø§Ù†":[29.4963,60.8629],
"Ú¯Ø±Ú¯Ø§Ù†":[36.8427,54.4448],"Ø¨ÙˆØ´Ù‡Ø±":[28.9234,50.8203],"Ø§ÛŒÙ„Ø§Ù…":[33.6370,46.4227],"Ø¨ÛŒØ±Ø¬Ù†Ø¯":[32.8649,59.2211],
"Ú¯Ø±Ù…Ø³Ø§Ø±":[35.2369,52.3096],"Ù†Ø¬Ùâ€ŒØ¢Ø¨Ø§Ø¯":[32.6378,51.3536],"Ø´Ø§Ø¯Ú¯Ø§Ù†":[30.5841,48.2716]
};

const API="https://air-quality-api.open-meteo.com/v1/air-quality";
const list=document.getElementById("list");
const meanDiv=document.getElementById("meanAQI");
let previousData=JSON.parse(localStorage.getItem("aqiData")||"{}");

function cls(v){
  if(v<=50)return"aqi-box good";
  if(v<=100)return"aqi-box mid";
  if(v<=150)return"aqi-box bad";
  return"aqi-box danger";
}

async function load(){
  list.innerHTML="";
  const promises=Object.entries(cities).map(async ([c,[lat,lon]])=>{
    const r=await fetch(`${API}?latitude=${lat}&longitude=${lon}&hourly=us_aqi`);
    const j=await r.json();
    const aqi=j?.hourly?.us_aqi?.[0]??"--";
    return {c,aqi};
  });

  const results=await Promise.all(promises);

  // Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† AQI
  const validAQI=results.filter(r=>r.aqi!=="--").map(r=>r.aqi);
  const meanAQI=validAQI.length? (validAQI.reduce((a,b)=>a+b,0)/validAQI.length).toFixed(1):"--";
  meanDiv.innerText=`Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ú©Ù„ Ø§ÛŒØ±Ø§Ù†: ${meanAQI}`;

  results.forEach(({c,aqi})=>{
    const prev=previousData[c];
    let changeText="ØªØºÛŒÛŒØ±: 0";
    let changeClass="";
    if(prev!==undefined && prev!=="--" && aqi!=="--"){
      const diff=aqi-prev;
      if(diff>0){changeText=`ØªØºÛŒÛŒØ±: +${diff}`; changeClass="change-up";}
      else if(diff<0){changeText=`ØªØºÛŒÛŒØ±: ${diff}`; changeClass="change-down";}
    }

    previousData[c]=aqi;

    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div>
        <div class="city">${c}</div>
        <div class="sub">${aqi<=50?"Ø®ÙˆØ¨":aqi<=100?"Ù…ØªÙˆØ³Ø·":aqi<=150?"Ù†Ø§Ù…Ù†Ø§Ø³Ø¨":"Ø¨Ø¯"}</div>
        <div class="change-box ${changeClass}">${changeText}</div>
      </div>
      <div class="${cls(aqi)}"><span>${aqi}</span></div>
    `;
    list.appendChild(card);
  });

  localStorage.setItem("aqiData",JSON.stringify(previousData));
}

document.getElementById("search").addEventListener("input",e=>{
  const q=e.target.value.trim().toLowerCase();
  document.querySelectorAll(".card").forEach(card=>{
    card.style.display = card.querySelector(".city").innerText.toLowerCase().includes(q)?"flex":"none";
  });
});

window.onload=()=>{
  setTimeout(()=>{
    loader.style.display="none";
    document.querySelector("main").style.display="block";
    load();
  },2500);
};
</script>
</body>
</html>
