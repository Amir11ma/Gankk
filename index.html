<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>شاخص آلودگی هوای ایران</title>

<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.min.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Vazirmatn,Tahoma;}
body{background:linear-gradient(135deg,#e3f2fd,#ede7f6);color:#222;overflow-x:hidden;padding:20px;}
header{text-align:center;font-size:26px;font-weight:900;margin-bottom:20px;color:#1e88e5;}

.box{max-width:420px;margin:auto;background:rgba(255,255,255,0.7);padding:20px;border-radius:16px;box-shadow:0 15px 35px rgba(0,0,0,0.15);backdrop-filter:blur(10px);}
.box input,.box button{width:100%;padding:12px;margin-top:10px;border-radius:12px;border:none;font-size:16px;}
.box button{background:#1e88e5;color:#fff;font-weight:700;cursor:pointer;}

.result{margin-top:15px;font-size:18px;font-weight:900;text-align:center;}

.good{color:#4caf50;font-weight:900;}
.mid{color:#ffc107;font-weight:900;}
.bad{color:#e53935;font-weight:900;}

.list{margin-top:20px;display:grid;gap:14px;}
.card{padding:16px;border-radius:18px;background:rgba(255,255,255,0.55);
backdrop-filter:blur(16px);box-shadow:0 15px 35px rgba(0,0,0,0.15);
display:flex;justify-content:space-between;align-items:center;}
</style>
</head>
<body>

<header>شاخص آلودگی هوای ایران</header>

<div class="box">
  <input id="city" placeholder="نام شهر (مثلاً یزد)">
  <button onclick="run()">جستجو</button>
  <div id="out" class="result">—</div>
</div>

<div class="list" id="list"></div>

<script>
const cities={
"تهران":[35.6892,51.3890],"مشهد":[36.2605,59.6168],"اصفهان":[32.6546,51.6680],
"شیراز":[29.5918,52.5837],"تبریز":[38.0962,46.2738],"کرج":[35.8400,51.0000],
"اهواز":[31.3183,48.6706],"قم":[34.6401,50.8764],"رشت":[37.2808,49.5832],
"بندرعباس":[27.1865,56.2808],"کرمان":[30.2839,57.0839],"یزد":[31.8974,54.3569],
"ارومیه":[37.5483,45.0672],"اراک":[34.0917,49.6892],"سنندج":[35.3219,46.9862],
"قزوین":[36.2688,50.0041],"خرم‌آباد":[33.4878,48.3550],"همدان":[34.8090,48.5150],
"سمنان":[35.5753,53.3958],"زاهدان":[29.4963,60.8629],
"گرگان":[36.8427,54.4448],"بوشهر":[28.9234,50.8203],
"ایلام":[33.6370,46.4227],"بیرجند":[32.8649,59.2211]
};

const API="https://air-quality-api.open-meteo.com/v1/air-quality";
const listDiv=document.getElementById("list");
const out=document.getElementById("out");
let rankingData={};

function getClass(aqi){
  if(aqi<=50) return "good";
  if(aqi<=100) return "mid";
  return "bad";
}

async function loadAll(){
  const promises=Object.entries(cities).map(async ([c,[lat,lon]])=>{
    const r=await fetch(`${API}?latitude=${lat}&longitude=${lon}&hourly=us_aqi`);
    const j=await r.json();
    const aqi=j?.hourly?.us_aqi?.[0]??0;
    rankingData[c]=aqi;
  });
  await Promise.all(promises);
  updateList();
}

function updateList(){
  listDiv.innerHTML="";
  Object.entries(rankingData).forEach(([c,aqi])=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<div>${c}</div><div class="${getClass(aqi)}">${aqi}</div>`;
    listDiv.appendChild(card);
  });
}

async function run(){
  const cityName=document.getElementById("city").value.trim();
  if(!cityName){alert("نام شهر را وارد کن");return;}

  out.innerText="در حال دریافت اطلاعات...";
  const geo=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${cityName},Iran`).then(r=>r.json());
  if(!geo.length){out.innerText="❌ شهر پیدا نشد";return;}

  const lat=geo[0].lat;
  const lon=geo[0].lon;
  const name=geo[0].display_name.split(",")[0];

  const air=await fetch(`${API}?latitude=${lat}&longitude=${lon}&hourly=us_aqi`).then(r=>r.json());
  const aqi=air?.hourly?.us_aqi?.[0];
  if(!aqi){out.innerText="❌ داده‌ای موجود نیست";return;}

  rankingData[name]=aqi;
  out.innerHTML=`${name}<br>AQI: <span class="${getClass(aqi)}">${aqi}</span>`;
  updateList();
}

loadAll();
</script>

</body>
</html>
